<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Stream</title>

  <link rel="stylesheet" href="./assets/styles.css">
</head>
<body>
  <header class="page__header">
    <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 101 35">
      <path d="M9.72.92V3.41a.92.92,0,0,1-.91.92H6.42a.92.92,0,0,0-.92.92V29.5a.92.92,0,0,0,.92.92H8.81a.92.92,0,0,1,.91.92V33.8a.91.91,0,0,1-.91.91H.92A.92.92,0,0,1,0,33.8V.92A.92.92,0,0,1,.92,0H8.81A.92.92,0,0,1,9.72.92Z" fill="#03CFBB"/>
      <path d="M27.48,9.45V27.1a.92.92,0,0,1-.91.92h-4a.92.92,0,0,1-.91-.92V9.45a.92.92,0,0,1,.91-.92h4A.92.92,0,0,1,27.48,9.45Z" fill="#03CFBB"/>
      <path d="M40.14,20V17.39a.92.92,0,0,1,.92-.91h9.87a.92.92,0,0,1,.92.91V20a.92.92,0,0,1-.92.92H41.06A.92.92,0,0,1,40.14,20Z" fill="#03CFBB"/>
      <path d="M100.65.92V33.8a.92.92,0,0,1-.92.91H91.84a.91.91,0,0,1-.91-.91V31.3a.92.92,0,0,1,.91-.92h2.39a.92.92,0,0,0,.92-.91V5.25a.92.92,0,0,0-.92-.92H91.84a.92.92,0,0,1-.91-.92V.92A.92.92,0,0,1,91.84,0h7.89A.92.92,0,0,1,100.65.92Z" fill="#03CFBB"/>
      <path d="M69.49,28.67c-.5,1.4-1.32,3.69-1.84,5.1A.91.91,0,0,0,68.51,35H72a.91.91,0,0,0,.86-.61c.61-1.75,2.26-6.59,2.36-6.91L81.08,9.15A.91.91,0,0,0,80.21,8h-4a.92.92,0,0,0-.89.7L72.59,19.9a.91.91,0,0,1-1.78,0L68.34,8.68a.93.93,0,0,0-.9-.72H63.25a.92.92,0,0,0-.88,1.18L67.76,26.8a.92.92,0,0,0,.87.65h0A.9.9,0,0,1,69.49,28.67Z" fill="#03CFBB"/>
    </svg>
  </header>

  <main>
    <section id="slider">
      <h2>Slider</h2>
      <template id="iy-slider-template">
        <style>
          :host {
            display: inline-block;
            height: 48px;
          }
          :host(:hover) rect.active-track {
            fill: #4700AB;
          }
          :host(:hover) ellipse.thumb {
            stroke: #4700AB;
          }
          :host(:hover) line.notch {
            stroke: #4700AB;
          }
          :host(:active) ellipse.thumb-outer {
            visibility: visible;
          }
          :host([disabled]) {
            opacity: 0.5;
          }
          svg {
            height: 48px;
          }
          svg * {
            pointer-events: none;
          }
          svg .clickable {
            pointer-events: auto;
          }
          ellipse.thumb-outer {
            opacity: 0.5;
            visibility: hidden;
          }
        </style>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 294 48">
          <rect class="runnable-track clickable" fill="#D9DBE9" height="12" width="278" rx="6" x="8" y="18" />
          <rect class="active-track" fill="#610BEF" height="12" width="166" rx="6" x="8" y="18" />
          <ellipse
              class="thumb-outer"
              cx="166"
              cy="24"
              fill="#BFBEFC"
              rx="24"
              ry="24"
          />
          <ellipse
              class="thumb clickable"
              cx="166"
              cy="24"
              fill="#FCFCFC"
              stroke="#610BEF"
              stroke-width="2"
              rx="14"
              ry="14"
          />
          <line
              class="notch"
              stroke="#610BEF"
              stroke-linecap="round"
              stroke-width="2"
              x1="166"
              x2="166"
              y1="20"
              y2="28"
          />
        </svg>
      </template>
      <script src="./slider/slider.js"></script>
      <div class="component" id="slider-basic">
        <h3>Basic</h3>
        <!-- Here's the relevant part -->
        <div class="component__demo">
          <iy-slider name="slider" value="0.3"></iy-slider>
          <input type="number" name="slider-input" min="0" max="100" />
        </div>
        <div class="component__description">
          The user can use a slider to input a number between two axioms.
          The default slider has a <code>value</code> attribute that is a number between 0 and 1.

          <pre><code>&lt;iy-slider value="0.3"&gt;&lt;/iy-slider&gt;</code></pre>
        </div>
        <div class="component__tests">
        </div>
        <script defer>
          const slider = document.querySelector(`iy-slider[name="slider"]`);
          const input = document.querySelector(`input[name="slider-input"]`);
          input.value = Math.floor(slider.value * 100);
          slider.addEventListener("change", (e) => {
            input.value = Math.floor(e.target.value * 100);
          });
          input.addEventListener("change", (e) => {
            if (slider.hasAttribute("disabled")) {
              e.target.value = Math.floor(slider.value * 100);
            } else {
              slider.value = Math.floor(e.target.value) / 100;
            }
          });

          window.addEventListener("load", () => window.createTests(
            [
              {
                auto: true,
                description: "The thumb is positioned in the middle.",
                test(slider) {
                  const width = Number(slider.shadowRoot.querySelector(".runnable-track").getAttribute("width"));
                  return ({ assertNextFrame }) => {
                    slider.value = 0.5;
                    return assertNextFrame(() => {
                      const x = Number(slider.shadowRoot.querySelector(".thumb").getAttribute("cx"));
                      return x === Math.floor(width / 2);
                    });
                  };
                }
              },
              {
                auto: true,
                description: "The thumb is positioned at the beginning.",
                test(slider) {
                  return ({ assertNextFrame }) => {
                    slider.value = 0;
                    return assertNextFrame(() => {
                      const x = Number(slider.shadowRoot.querySelector(".thumb").getAttribute("cx"));
                      return x === 24;
                    });
                  };
                }
              },
              {
                auto: true,
                description: "Setting the value key updates the position of the thumb.",
                test(slider) {
                  const x1 = Number(slider.shadowRoot.querySelector(".thumb").getAttribute("cx"));
                  return ({ assertNextFrame }) => {
                    slider.value = 0;
                    return assertNextFrame(() => {
                      const x2 = Number(slider.shadowRoot.querySelector(".thumb").getAttribute("cx"));
                      return x1 !== x2;
                    });
                  };
                }
              },
              {
                auto: true,
                description: "Setting the attribute updates the value.",
                test(slider) {
                  return ({ assertNextFrame }) => {
                    slider.setAttribute("value", "0.5");
                    return assertNextFrame(() => {
                      const v = slider.value;
                      return v === 0.5;
                    });
                  };
                }
              },
              {
                auto: true,
                description: "Setting the attribute dispatches the event.",
                test(slider) {
                  return () => new Promise((resolve, reject) => {
                    const t = window.setTimeout(() => reject(new Error("Timed-out")), 100);

                    const f = () => {
                      resolve();
                      window.clearTimeout(t);
                    };
                    slider.addEventListener("change", f);
                    slider.setAttribute("value", "1");
                    slider.removeEventListener("change", f);
                  });
                }
              },
              {
                auto: true,
                description: "Disabled: Setting the value key does nothing.",
                test(slider) {
                  return ({ assertNextFrame }) => {
                    const x1 = Number(slider.shadowRoot.querySelector(".thumb").getAttribute("cx"));
                    slider.setAttribute("disabled", "1");
                    if (slider.value === 0) console.warn("Value was already 0...");
                    slider.value = 0;
                    return assertNextFrame(() => {
                      const x2 = Number(slider.shadowRoot.querySelector(".thumb").getAttribute("cx"));
                      return x1 === x2;
                    })
                      .then(() => {
                        slider.removeAttribute("disabled");
                      });
                  }
                }
              },
              {
                auto: true,
                description: "Disabled: Setting the attribute doesn't updated the value.",
                test(slider) {
                  return ({ assertNextFrame }) => {
                    const v1 = slider.value;
                    slider.setAttribute("disabled", "1");
                    slider.setAttribute("value", "0");
                    return assertNextFrame(() => {
                      const v2 = slider.value;
                      return v1 === v2;
                    })
                      .then(() => {
                        slider.removeAttribute("disabled");
                      });
                  }
                }
              },
              {
                auto: true,
                description: "Disabled: Setting the attribute doesn't dispatch an event.",
                test(slider) {
                  return () => new Promise((resolve, reject) => {
                    const t = window.setTimeout(() => {
                      resolve();
                      slider.removeAttribute("disabled");
                    }, 100);
                    slider.setAttribute("disabled", "1");
                    const f = () => {
                      reject(new Error("Event was dispatched"));
                      window.clearTimeout(t);
                    };
                    slider.addEventListener("change", f);
                    slider.setAttribute("value", "1");
                    slider.removeEventListener("change", f);
                  });
                }
              }
            ],
            document.querySelector("#slider-basic .component__tests"),
            slider
          ));
        </script>
      </div>

      <div class="component" id="slider-range">
        <h3>Range</h3>
        <!-- Here's the relevant part -->
        <div class="component__demo">
          <iy-slider name="slider-range" min="0.3" max="0.7"></iy-slider>
          <div class="component__demo-input">
            <input type="number" name="slider-range-min" min="0" max="99" />
            <input type="number" name="slider-range-max" min="1" max="100" />
          </div>
        </div>
        <div class="component__description">
          The user can use a slider of type range to input a range of number between to axioms.
          The slider of type range has two attributes: <code>min</code> and <code>max</code> that are
          numbers between 0 and 1.

          <pre><code>&lt;iy-slider min="0.3" max="0.7"&gt;&lt;/iy-slider&gt;</code></pre>
        </div>
        <div class="component__tests">

        </div>

        <script>
          const sliderRange = document.querySelector(`iy-slider[name="slider-range"]`);
          const minInput = document.querySelector(`input[name="slider-range-min"]`);
          const maxInput = document.querySelector(`input[name="slider-range-max"]`);
          minInput.value = Math.floor(sliderRange.min * 100);
          maxInput.value = Math.floor(sliderRange.max * 100);
          sliderRange.addEventListener("change", (e) => {
            minInput.value = Math.floor(e.target.min * 100);
            maxInput.value = Math.floor(e.target.max * 100);
          });

          const handleInput = (e) => {
            const d = e.target.getAttribute("name") === "slider-range-min" ? "min" : "max";
            if (slider.hasAttribute("disabled")) {
              e.target.value = Math.floor(slider[d] * 100);
            } else {
              sliderRange[d] = Math.floor(e.target.value) / 100;
            }
          };
          minInput.addEventListener("change", handleInput);
          maxInput.addEventListener("change", handleInput);

          window.addEventListener("load", () => window.createTests(
            [
              {
                description: "Setting the value key updates the position of the thumbs.",
                test(slider) {
                  return ({ assertNextFrame }) => {
                    slider.min = 0.1;
                    slider.max = 0.9;
                    return assertNextFrame(() => {
                      const x1 = Number(slider.shadowRoot.querySelector(".thumb__min").getAttribute("cx"));
                      const x2 = Number(slider.shadowRoot.querySelector(".thumb__max").getAttribute("cx"));
                      return x1 === 27 && x2 === 250;
                    });
                  }
                }
              },
            ],
            document.querySelector("#slider-range .component__tests"),
            sliderRange
          ));
        </script>
      </div>
    </section>
  </main>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/newton.css">
  <script src="./test/test.js"></script>
  <script src="./assets/highlight.pack.js"></script>
  <script>
    window.addEventListener("load", () => {
      document.querySelectorAll("pre code")
        .forEach(e => window.hljs.highlightBlock(e));
    });
  </script>
</body>
</html>
